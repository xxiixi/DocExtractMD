# Multi-GPU 并发处理功能

## 概述

本前端应用现在支持 Multi-GPU 并发处理模式，可以同时处理多个 PDF 文件，显著提高处理效率。

## 功能特点

### 🚀 并发处理
- 支持同时处理多个 PDF 文件
- 可配置最大并发数（默认4个）
- 智能批处理，避免资源过载

### ⚙️ 灵活配置
- 支持多种后端：pipeline、vlm-transformers、vlm-sglang-engine、vlm-sglang-client
- 可配置文档语言、解析方法
- 支持公式和表格解析开关

### 📊 实时进度
- 显示处理进度和当前处理的文件
- 详细的处理状态反馈
- 错误处理和重试机制

## 使用方法

### 1. 启动 Multi-GPU 服务器

首先需要启动 Multi-GPU 服务器。参考 `MinerU-Local/projects/multi_gpu_v2/client.py` 中的服务器配置：

```bash
# 启动服务器（需要先配置好服务器端）
# 服务器应该监听在 http://127.0.0.1:8000/predict
```

### 2. 配置前端

在前端界面中：

1. **启用 Multi-GPU 模式**：在左侧面板中找到 "Multi-GPU 并发处理" 开关
2. **配置服务器地址**：默认是 `http://127.0.0.1:8000`，根据实际情况修改
3. **设置并发数**：根据服务器性能调整最大并发数（建议 2-8）
4. **选择后端**：
   - `pipeline`：通用后端，适合大多数场景
   - `vlm-transformers`：基于 Transformers 的视觉语言模型
   - `vlm-sglang-engine`：速度最快，但需要 24+ GB 显存
   - `vlm-sglang-client`：连接到远程 SGLang 服务器

### 3. 上传和处理文件

1. 上传多个 PDF 文件
2. 确保 Multi-GPU 模式已启用
3. 点击 "开始解析" 按钮
4. 系统会自动使用并发模式处理所有文件

## 配置选项说明

### 基本配置
- **服务器地址**：Multi-GPU 服务器的 URL
- **最大并发数**：同时处理的最大文件数
- **处理后端**：选择使用的 MinerU 后端
- **文档语言**：指定文档的主要语言，提高 OCR 准确率

### 功能开关
- **启用公式解析**：是否解析文档中的数学公式
- **启用表格解析**：是否解析文档中的表格结构

## 性能优化建议

### 服务器端
1. **GPU 资源**：确保服务器有足够的 GPU 显存
2. **并发数设置**：根据 GPU 数量和显存大小调整
3. **网络带宽**：确保服务器和客户端之间的网络连接稳定

### 客户端
1. **文件大小**：建议单个文件不超过 50MB
2. **文件数量**：建议一次处理 2-10 个文件
3. **网络环境**：确保网络连接稳定

## 故障排除

### 常见问题

1. **连接失败**
   - 检查服务器地址是否正确
   - 确认服务器是否正在运行
   - 检查防火墙设置

2. **处理超时**
   - 增加超时时间设置
   - 减少并发数
   - 检查服务器性能

3. **内存不足**
   - 减少并发数
   - 使用更轻量的后端
   - 检查服务器显存使用情况

### 错误处理

- 系统会自动重试失败的文件
- 详细的错误信息会显示在文件列表中
- 支持手动重试单个文件

## 技术架构

```
前端 (React) 
    ↓ HTTP/JSON
Multi-GPU 客户端
    ↓ Base64 编码
Multi-GPU 服务器
    ↓ MinerU 处理
GPU 集群
```

## 环境变量配置

可以通过环境变量配置默认设置：

```bash
# .env.local
NEXT_PUBLIC_MULTI_GPU_URL=http://127.0.0.1:8000
```

## 开发说明

### 添加新的后端支持

1. 在 `MultiGpuOptions` 接口中添加新的后端类型
2. 在 `MultiGpuControls` 组件中添加对应的选项
3. 更新常量配置文件

### 自定义处理逻辑

1. 修改 `multiGpuClient.ts` 中的处理逻辑
2. 更新 `fileProcessor.ts` 中的集成代码
3. 测试新的功能

## 版本历史

- **v1.0.0**：初始版本，支持基本的并发处理
- 支持多种后端配置
- 实时进度显示
- 错误处理和重试机制
