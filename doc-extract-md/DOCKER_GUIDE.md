# Docker éƒ¨ç½²æŒ‡å—

## ğŸ“– Docker åŸç†è¯¦è§£

### ä»€ä¹ˆæ˜¯ Dockerï¼Ÿ

Docker æ˜¯ä¸€ä¸ª**å®¹å™¨åŒ–å¹³å°**ï¼Œå®ƒå¯ä»¥å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªç§°ä¸º"å®¹å™¨"çš„æ ‡å‡†åŒ–å•å…ƒä¸­ã€‚

### ğŸ—ï¸ å®¹å™¨ vs è™šæ‹Ÿæœº

```
ä¼ ç»Ÿè™šæ‹Ÿæœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨ç¨‹åº A                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ“ä½œç³»ç»Ÿ A                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           è™šæ‹Ÿæœºç›‘æ§å™¨               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ä¸»æœºæ“ä½œç³»ç»Ÿ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker å®¹å™¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨ç¨‹åº A                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åº”ç”¨ç¨‹åº B                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           åº”ç”¨ç¨‹åº C                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Docker å¼•æ“               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ä¸»æœºæ“ä½œç³»ç»Ÿ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- ğŸš€ **æ›´è½»é‡**ï¼šå®¹å™¨å…±äº«ä¸»æœºå†…æ ¸ï¼Œå ç”¨èµ„æºæ›´å°‘
- âš¡ **æ›´å¿«é€Ÿ**ï¼šå¯åŠ¨æ—¶é—´ä»¥ç§’ä¸ºå•ä½
- ğŸ”„ **æ›´ä¸€è‡´**ï¼šåœ¨ä»»ä½•ç¯å¢ƒéƒ½èƒ½ä¿è¯ç›¸åŒçš„è¿è¡Œç¯å¢ƒ
- ğŸ“¦ **æ›´ä¾¿æº**ï¼šä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œ

### ğŸ›ï¸ Docker æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Client             â”‚ â† ç”¨æˆ·å‘½ä»¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Docker Daemon             â”‚ â† åå°æœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Docker Registry           â”‚ â† é•œåƒä»“åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¦ æ ¸å¿ƒæ¦‚å¿µ

1. **é•œåƒ (Image)**ï¼šåº”ç”¨ç¨‹åºçš„æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œç¯å¢ƒ
2. **å®¹å™¨ (Container)**ï¼šé•œåƒçš„è¿è¡Œå®ä¾‹
3. **ä»“åº“ (Registry)**ï¼šå­˜å‚¨é•œåƒçš„åœ°æ–¹
4. **Dockerfile**ï¼šæ„å»ºé•œåƒçš„æŒ‡ä»¤æ–‡ä»¶

## ğŸ› ï¸ å®‰è£… Docker

### Windows 10/11
1. ä¸‹è½½ [Docker Desktop](https://www.docker.com/products/docker-desktop/)
2. å®‰è£…å¹¶é‡å¯ç”µè„‘
3. å¯åŠ¨ Docker Desktop

### Windows 7
ç”±äº Docker Desktop ä¸æ”¯æŒ Win7ï¼Œå»ºè®®ï¼š
1. ä½¿ç”¨è™šæ‹Ÿæœºå®‰è£… Linux
2. åœ¨ Linux ä¸­å®‰è£… Docker
3. æˆ–è€…ä½¿ç”¨ Docker Toolboxï¼ˆå·²åœæ­¢ç»´æŠ¤ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ„å»ºé•œåƒ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd DocExtractMD/doc-extract-md

# æ„å»ºç”Ÿäº§é•œåƒ
docker build -t doc-extract-md:latest .

# æ„å»ºå¼€å‘é•œåƒ
docker build -f Dockerfile.dev -t doc-extract-md:dev .
```

### 2. è¿è¡Œå®¹å™¨

```bash
# è¿è¡Œç”Ÿäº§å®¹å™¨
docker run -d \
  --name doc-extract-md \
  -p 3000:3000 \
  -e NEXT_PUBLIC_MINERU_API_URL=http://10.81.117.115:8501/mineru \
  doc-extract-md:latest

# è¿è¡Œå¼€å‘å®¹å™¨
docker run -d \
  --name doc-extract-md-dev \
  -p 3001:3000 \
  -v $(pwd):/app \
  -e NEXT_PUBLIC_MINERU_API_URL=http://10.81.117.115:8501/mineru \
  doc-extract-md:dev
```

### 3. ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
docker-compose up -d

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose --profile dev up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### é•œåƒç®¡ç†
```bash
# åˆ—å‡ºæ‰€æœ‰é•œåƒ
docker images

# åˆ é™¤é•œåƒ
docker rmi doc-extract-md:latest

# å¼ºåˆ¶åˆ é™¤é•œåƒ
docker rmi -f doc-extract-md:latest
```

### å®¹å™¨ç®¡ç†
```bash
# åˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨
docker ps

# åˆ—å‡ºæ‰€æœ‰å®¹å™¨
docker ps -a

# å¯åŠ¨å®¹å™¨
docker start doc-extract-md

# åœæ­¢å®¹å™¨
docker stop doc-extract-md

# é‡å¯å®¹å™¨
docker restart doc-extract-md

# åˆ é™¤å®¹å™¨
docker rm doc-extract-md

# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it doc-extract-md sh
```

### æ—¥å¿—å’Œç›‘æ§
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs doc-extract-md

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f doc-extract-md

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats
```

## ğŸ”§ é…ç½®æ–‡ä»¶è¯¦è§£

### Dockerfile ç»“æ„

```dockerfile
# åŸºç¡€é•œåƒ
FROM node:18-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å‘½ä»¤
CMD ["npm", "start"]
```

### docker-compose.yml ç»“æ„

```yaml
version: '3.8'
services:
  app:
    build: .                    # æ„å»ºä¸Šä¸‹æ–‡
    ports:
      - "3000:3000"            # ç«¯å£æ˜ å°„
    environment:                # ç¯å¢ƒå˜é‡
      - NODE_ENV=production
    volumes:                    # æ•°æ®å·
      - ./uploads:/app/uploads
    restart: unless-stopped     # é‡å¯ç­–ç•¥
```

## ğŸŒ ç½‘ç»œé…ç½®

### å®¹å™¨ç½‘ç»œæ¨¡å¼

1. **bridge**ï¼ˆé»˜è®¤ï¼‰ï¼šå®¹å™¨é—´é€šè¿‡Dockerç½‘æ¡¥é€šä¿¡
2. **host**ï¼šå®¹å™¨ç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œ
3. **none**ï¼šå®¹å™¨æ— ç½‘ç»œè®¿é—®

### ç«¯å£æ˜ å°„

```bash
# æ ¼å¼ï¼šä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
-p 3000:3000    # ä¸»æœº3000ç«¯å£æ˜ å°„åˆ°å®¹å™¨3000ç«¯å£
-p 8080:3000    # ä¸»æœº8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨3000ç«¯å£
```

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### æ•°æ®å· (Volumes)

```bash
# åˆ›å»ºæ•°æ®å·
docker volume create my-data

# ä½¿ç”¨æ•°æ®å·
docker run -v my-data:/app/data doc-extract-md

# ç»‘å®šæŒ‚è½½
docker run -v /host/path:/container/path doc-extract-md
```

### æ–‡ä»¶ä¸Šä¼ ç›®å½•

```yaml
volumes:
  - ./uploads:/app/uploads  # ä¸Šä¼ æ–‡ä»¶æŒä¹…åŒ–
  - ./logs:/app/logs        # æ—¥å¿—æ–‡ä»¶æŒä¹…åŒ–
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :3000

# ä¿®æ”¹ç«¯å£æ˜ å°„
-p 3001:3000
```

2. **æƒé™é—®é¢˜**
```bash
# ä¿®æ”¹æ–‡ä»¶æƒé™
chmod -R 755 ./uploads

# ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
USER nextjs
```

3. **å†…å­˜ä¸è¶³**
```bash
# é™åˆ¶å†…å­˜ä½¿ç”¨
docker run -m 512m doc-extract-md

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune
```

### è°ƒè¯•æŠ€å·§

```bash
# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it doc-extract-md sh

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect doc-extract-md

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs doc-extract-md

# å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
docker cp local-file.txt doc-extract-md:/app/
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### é•œåƒä¼˜åŒ–

1. **å¤šé˜¶æ®µæ„å»º**ï¼šå‡å°‘æœ€ç»ˆé•œåƒå¤§å°
2. **ä½¿ç”¨ .dockerignore**ï¼šæ’é™¤ä¸å¿…è¦æ–‡ä»¶
3. **åˆå¹¶RUNå‘½ä»¤**ï¼šå‡å°‘é•œåƒå±‚æ•°
4. **ä½¿ç”¨AlpineåŸºç¡€é•œåƒ**ï¼šå‡å°åŸºç¡€é•œåƒå¤§å°

### å®¹å™¨ä¼˜åŒ–

1. **èµ„æºé™åˆ¶**ï¼šè®¾ç½®CPUå’Œå†…å­˜é™åˆ¶
2. **å¥åº·æ£€æŸ¥**ï¼šç›‘æ§å®¹å™¨çŠ¶æ€
3. **é‡å¯ç­–ç•¥**ï¼šè‡ªåŠ¨æ¢å¤æœåŠ¡
4. **æ—¥å¿—è½®è½¬**ï¼šé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§

## ğŸ” å®‰å…¨è€ƒè™‘

1. **ä½¿ç”¨érootç”¨æˆ·**ï¼šé¿å…æƒé™æå‡
2. **æœ€å°åŒ–é•œåƒ**ï¼šå‡å°‘æ”»å‡»é¢
3. **å®šæœŸæ›´æ–°**ï¼šä¿®å¤å®‰å…¨æ¼æ´
4. **ç½‘ç»œéš”ç¦»**ï¼šé™åˆ¶å®¹å™¨ç½‘ç»œè®¿é—®

## ğŸ“š è¿›é˜¶å­¦ä¹ 

### æ¨èèµ„æº
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)

### ä¸‹ä¸€æ­¥
- å­¦ä¹  Docker Swarm æˆ– Kubernetes
- äº†è§£ CI/CD æµæ°´çº¿é›†æˆ
- æ¢ç´¢å¾®æœåŠ¡æ¶æ„
- å­¦ä¹ å®¹å™¨ç¼–æ’æŠ€æœ¯

---

## ğŸ¯ é¡¹ç›®ç‰¹å®šé…ç½®

### ç¯å¢ƒå˜é‡
```bash
# .env æ–‡ä»¶
NEXT_PUBLIC_MINERU_API_URL=http://10.81.117.115:8501/mineru
NODE_ENV=production
```

### ç½‘ç»œé…ç½®
ç¡®ä¿å®¹å™¨èƒ½å¤Ÿè®¿é—®å…¬å¸å†…ç½‘çš„MinerUæœåŠ¡ï¼š
```yaml
networks:
  - doc-extract-network
```

### å¥åº·æ£€æŸ¥
```yaml
healthcheck:
  test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health"]
  interval: 30s
  timeout: 10s
  retries: 3
```

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨Dockeréƒ¨ç½²æ‚¨çš„åº”ç”¨äº†ï¼ğŸ‰
